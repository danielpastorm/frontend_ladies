<div class="card">
    <p-toast></p-toast>
    <div class="product-grid">
        <div *ngFor="let kitGroup of kitsGrouped" class="product-card">
            <!-- Si en el futuro quieres mostrar una imagen del kit, puedes usar la sección product-image -->
            <!-- Carrusel de imágenes -->


            <div *ngIf="kitGroup.imagenes && kitGroup.imagenes.trim().length > 0" class="image-container">
                <p-carousel [value]="getKitImages(kitGroup.imagenes)" [numVisible]="1" [circular]="true"
                    [autoplayInterval]="3000">
                    <ng-template pTemplate="item" let-image>
                        <div class="image-item">
                            <img [src]="'https://ladies-first.shop/uploads/kit_' + kitGroup.kitId + '/' + image"
                                alt="Imagen del kit">
                        </div>
                    </ng-template>
                </p-carousel>
            </div>


            <div class="product-info">
                <!-- Datos del kit -->
                <h3>{{ kitGroup.kitNombre }}</h3>
                <p>{{ kitGroup.kitDescripcion }}</p>
                <p>
                    <strong>Precio Total:</strong>
                    {{ kitGroup.kitPrecio | currency }}
                </p>
                <p>
                    <strong>Disponible:</strong>
                    {{ kitGroup.disponible ? 'Sí' : 'No' }}
                </p>
                <hr>
                <!-- Lista de productos -->
                <h4>Productos</h4>
                <ul>
                    <li *ngFor="let prod of kitGroup.productos">
                        <strong>{{ prod.nombreProducto }}</strong> &ndash;
                        Cantidad: {{ prod.cantidad }} &ndash;
                        Precio Unitario: {{ prod.precioUnitario | currency }}
                    </li>
                </ul>
                <p-button label="Editar" icon="pi pi-pencil" (click)="selectKit(kitGroup)" class="edit-button" />

            </div>
        </div>
    </div>
</div>


<p-dialog header="Editar Kit" [(visible)]="displayEditModal" modal="true" [style]="{'width': '40rem'}"
    [contentStyle]="{'overflow-y': 'auto'}" appendTo="body">
    <div class="p-fluid">

        <div class="grid">
            <div class="col-12 md:col-12 mt-3 flex justify-content-end">
                <p-button label="Actualizar" (click)="update()"></p-button>
            </div>


            <div class="col-12 md:col-6 mt-3">
                <p-floatlabel variant="on">
                    <input pInputText id="on_label" [(ngModel)]="selectedKit.kitNombre" autocomplete="off" />
                    <label for="on_label">Nombre del kit</label>
                </p-floatlabel>
            </div>

            <div class="col-12 md:col-6 mt-3">
                <p-floatlabel variant="on">
                    <input pInputText id="on_label" [(ngModel)]="selectedKit.kitDescripcion" autocomplete="off" />
                    <label for="on_label">Descripción del kit</label>
                </p-floatlabel>
            </div>

            <div class="col-12 md:col-12 mt-3">
                <p-floatlabel variant="on">
                    <p-inputnumber [(ngModel)]="selectedKit.kitPrecio" [showButtons]="true" inputId="stacked"
                        mode="currency" currency="MXN" />
                    <label for="on_label">Precio</label>
                </p-floatlabel>
            </div>

            <div class="col-7 md:col-4 mt-3 ">
                <p-select placeholder="Selecciona un producto" [options]="productos" optionLabel="nombre"
                    [editable]="true" class="wd:40p" [(ngModel)]="selectedProducto" name="selectedProducto">
                </p-select>
            </div>


            <div class="col-5 md:col-4 mt-3">
                <p-floatlabel variant="on">
                    <p-inputNumber [(ngModel)]="cantidad" [min]="1" placeholder="Cantidad" class="w-full md:w-56"
                        name="cantidad"></p-inputNumber>
                    <label for="on_label">Cantidad</label>
                </p-floatlabel>

            </div>

            <div class="col-3 md:col-3 mt-1">
                <div class="p-field" style="margin-top: 10px;">
                    <p-button label="Agregar" icon="pi pi-plus" (onClick)="agregarProducto()" class="w-full"
                        severity="info" rounded />

                </div>
            </div>


            <div class="col-12 md:col-12 mt-3">

                <p-table [value]="selectedKit.productos">
                    <ng-template #header>
                        <tr>
                            <th>Nombre</th>
                            <th>Descripción</th>

                            <th style="width: 5rem"></th>
                        </tr>
                    </ng-template>
                    <ng-template #body let-product>
                        <tr>
                            <td>{{ product.nombreProducto }}</td>
                            <td>{{ product.precioUnitario }}</td>

                            <td>
                                <p-button icon="pi pi-trash" (click)="removeProductFromKit(product.productoId)"
                                    severity="warn" rounded />
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>


            <div class="col-12 md:col-12 mt-3">

                <div class="card">
                    <p-fileupload #fileUpload name="file"
                        [url]="'https://ladies-first.shop/Images/AgregarImagenesKit/' + selectedKit.kitId"
                        (onSelect)="onSelect($event)" (onUpload)="onUpload($event)" (onError)="onError($event)"
                        (onClear)="onClear($event)" [auto]="true" [multiple]="true" accept="image/*"
                        maxFileSize="4000000" mode="basic">
                        <ng-template #empty>
                            <div>Arrastra y suelta archivos para subirlos.</div>
                        </ng-template>
                    </p-fileupload>
                </div>


                <p-table [value]="getKitImages(selectedKit.imagenes)">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Imagen</th>
                            <th style="width: 5rem"></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-img let-i="index">
                        <tr>
                            <td>
                                <img [src]="'https://ladies-first.shop/uploads/kit_' + selectedKit.kitId + '/' + img"
                                    alt="Imagen del kit" style="max-width: 100px;">
                            </td>
                            <td>
                                <p-button icon="pi pi-trash" (click)="removeKitImage(img)" severity="warn"
                                    rounded></p-button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>






        </div>



    </div>

</p-dialog>